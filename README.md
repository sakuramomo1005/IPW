### Outcome model

The outcome $Y_{ijl}$ is generated by:
$$\pi_{ijl}=expit(1+ 1.36 * i +  x_{ijl}+\delta_{ij}) $$ 

1. $i$ is the treatment indicator. $i=1$ treated; $i=0$ control

2. $x$ is the covariate. $x \sim N(0,0.2)$ (The variance is 0.2. I choose a relatively small variance since I want to avoid non-convergence. However, this generated small differences between CRA and adjusted CRA. )

3. The variance of $\delta_{ij}$ changed based on different ICC (the ICC for the datasets):

* ICC=0.05, $\delta_{ij} \sim N(0, 0.173)$ (the variance is 0.173)

* ICC=0.1, $\delta_{ij} \sim N(0, 0.366)$ (the variance is 0.366)

* ICC=0.2, $\delta_{ij} \sim N(0, 0.823)$ (the variance is 0.823)

4. Number of clusters: **10, 25, 50 ** clusters in each intervention arm

5. Cluster size: the cluster size is from a Poisson distribution, which is not fixed. cluster size $\sim POI(50)$ 


### Missingness generation model

$$ logit(R_{ijl}=1|Y_{ij},X_{ij})= intercept +  i  +  X_{ijl} + \sigma_{ij} $$
1. The intercept is varied to make sure the misisng percentage is around 30%

2. $i$ is the treatment indicator. $i$=1 treated; $i$=0 control

3. $x$ is the covariate. $x \sim N(0,0.2)$ (The variance is 0.2)

4. The variance of $\sigma_{ij}$ represents the cluster effects in missingness. It changed based on different missingness ICC:

* $\sigma_{ij}=0$, the missing ICC=0, there is no cluster effects

* ICC=0.1, $\sigma_{ij} \sim N(0, 0.366)$ (the variance is 0.366)

* ICC=0.3, $\sigma_{ij} \sim N(0, 1.410)$ (the variance is 1.410)

* ICC=0.5, $\sigma_{ij} \sim N(0, 3.291)$ (the variance is 3.291)

* ICC=0.7, $\sigma_{ij} \sim N(0, 7.678)$ (the variance is 7.678)

* ICC=0.9, $\sigma_{ij} \sim N(0, 29.616)$ (the variance is 29.616)

5. 1000 replicates for each scenario         

### Missingness handling methods

**1. Calculation of true value**: 

* Fit the GEE with the formula: Y $\sim$ intervention arm (without covariates). Estimate the coefficient of intervention arm.  

* With full datasets without missing values

* Repeat for 1000 times and calculate the mean value. 


**2. UCRA: unadjusted complete record analysis**

* Fit the GEE with the formula: Y $\sim$ intervention arm (without covariates). Estimate the coefficient of intervention arm.  

* Delete the records with missing values in Y

* Repeat for 1000 times. 


**3. CRA: adjusted complete record analysis**

* Fit the GEE with formula: Y $\sim$ intervention-arm + X (with covariates). Estimate the coefficient of intervention arm.  

* Delete the records with missing values in Y

* Repeat for 1000 times. 


**4. IPW: inverse probability weighting**

* Calculate the weights by fitting GLM: glm(y $\sim$ arm + x)

* Fit the GEE with the formula: Y $\sim$ intervention arm (without covariates) with corresponding weights. Estimate the coefficient of intervention arm.  

* Repeat for 1000 times. 



**5. IPWC: inverse probability weighting with cluster effects**

* Calculate the weights by fitting generalized linear mixed effect model: glmer (y $\sim$ arm + x + cluster effect)

* Fit the GEE with the formula: Y $\sim$ intervention arm (without covariates) with corresponding weights. Estimate the coefficient of intervention arm.  

* Repeat for 1000 times. 

**6. MMI: multilevel multiple imputation**

* consider cluster effects in the imputation



## Recall the model

### Outcome model

The outcome $Y_{ijl}$ is generated by:
$$\pi_{ijl}=expit(1+ 1.36 * i +  x_{ijl}+\delta_{ij}) $$ 

$x \sim N(0,2)$ (the variance is 2)

The variance of $\delta$ changed based on different ICC:

* ICC=0.01, $\delta \sim N(0, 0.033)$ (the variance is 0.033)

* ICC=0.05, $\delta \sim N(0, 0.173)$ (the variance is 0.173)

* ICC=0.1, $\delta \sim N(0, 0.366)$ (the variance is 0.366)

### Missingness generation model

$$ logit(R_{ijl}=1|Y_{ij},X_{ij})= -1.6 +  i  +  X_{ijl} $$
* Misisng percentage: 0.3

* No cluster effect in the missingness generation model

* No nuisance adjustment

* 1000 replicates

## Results


### independent working correlation matrix

|         |   est|  bias|  mcsd|   std|   cov| un|  icc|
|:--------|-----:|-----:|-----:|-----:|-----:|--:|----:|
|ucra     | 1.042| 0.315| 0.076| 0.075| 0.020|  0| 0.01|
|cra      | 1.357| 0.000| 0.091| 0.089| 0.942|  0| 0.01|
|ipw      | 1.365| 0.007| 0.168| 0.159| 0.936|  0| 0.01|
|ipw_clu  | 1.365| 0.007| 0.168| 0.160| 0.936|  0| 0.01|
|mmi      | 1.383| 0.025| 0.103| 0.140| 1.000|  0| 0.01|
|ucra1    | 1.026| 0.300| 0.093| 0.093| 0.106|  0| 0.05|
|cra1     | 1.326| 0.000| 0.114| 0.114| 0.953|  0| 0.05|
|ipw1     | 1.332| 0.006| 0.180| 0.174| 0.946|  0| 0.05|
|ipw_clu1 | 1.332| 0.006| 0.180| 0.174| 0.948|  0| 0.05|
|mmi1     | 1.350| 0.024| 0.123| 0.162| 1.000|  0| 0.05|
|ucra2    | 1.004| 0.280| 0.114| 0.113| 0.294|  0| 0.10|
|cra2     | 1.284| 0.000| 0.141| 0.138| 0.940|  0| 0.10|
|ipw2     | 1.284| 0.000| 0.195| 0.190| 0.944|  0| 0.10|
|ipw_clu2 | 1.284| 0.000| 0.195| 0.191| 0.944|  0| 0.10|
|mmi2     | 1.304| 0.020| 0.149| 0.184| 1.000|  0| 0.10|

### exchangeable working correlation matrix

|         |   est|  bias|  mcsd|   std|   cov| un|  icc|
|:--------|-----:|-----:|-----:|-----:|-----:|--:|----:|
|ucra     | 1.042| 0.315| 0.076| 0.075| 0.020|  0| 0.01|
|cra      | 1.358| 0.000| 0.091| 0.089| 0.941|  0| 0.01|
|ipw      | 1.366| 0.008| 0.166| 0.156| 0.930|  1| 0.01|
|ipw_clu  | 1.366| 0.008| 0.166| 0.156| 0.929|  1| 0.01|
|mmi      | 1.376| 0.019| 0.103| 0.138| 1.000|  0| 0.01|
|ucra1    | 1.026| 0.298| 0.093| 0.093| 0.111|  0| 0.05|
|cra1     | 1.324| 0.000| 0.116| 0.115| 0.954|  0| 0.05|
|ipw1     | 1.334| 0.010| 0.174| 0.153| 0.873|  1| 0.05|
|ipw_clu1 | 1.334| 0.010| 0.174| 0.153| 0.873|  1| 0.05|
|mmi1     | 1.333| 0.008| 0.123| 0.159| 1.000|  0| 0.05|
|ucra2    | 1.004| 0.273| 0.114| 0.113| 0.315|  0| 0.10|
|cra2     | 1.277| 0.000| 0.145| 0.143| 0.941|  0| 0.10|
|ipw2     | 1.287| 0.009| 0.189| 0.141| 0.766|  1| 0.10|
|ipw_clu2 | 1.287| 0.009| 0.189| 0.141| 0.764|  1| 0.10|
|mmi2     | 1.274| 0.004| 0.149| 0.184| 1.000|  0| 0.10|
